# UNIX 명령어

## **셸**

- 명령어를 해석하고 관리하는 프로그램
    - 리눅스 내부의 커널과 사용자 간 가교 역할
- 스크립트 언어

## **셸 명령어 형식**

```bash
command options arguments
ls -l /etc/
```

- 명령어에 따라 옵션이나 인수가 필수적일 수도 있고, 선택적일 수도 있음
- 여러 옵션이나 여러 인수가 들어올 수도 있음

## **셸 종류**

- sh (Borne Shell)
- bash (Borne Again Shell)
    - 리눅스에서 가장 많이 사용되며, 기본 셸임
- zsh (Z Shell)
    - Mac에서 기본 셸로 사용됨 (from catalina)
    - Oh-My-Zsh이라는 플러그인이 있어 테마 등 확장기능을 제공함
    - csh (C Shell), tcsh (TC Shell)…
- 미션 도전!
    1. `echo $SHELL`을 실행해보세요. 현재 사용하는 셸은 무엇인가요?
    2. 컴퓨터마다 실행할 수 있는 셸이 다를 수 있습니다. `cat /etc/shells` 를 입력해서 사용 가능한 셸의 목록을 확인해보세요.
        1. `cat` : 텍스트 파일 내용을 표시 (concatenate)
        2. `/etc` : 시스템 설정파일 디렉터리
    3. 각 셸을 실행해보세요. (빠져 나오려면 `exit` 을 하시면 됩니다.)
    

## **셸 초기화 스크립트**

- 로그인할 때 혹은 로그인 후 셸 시작할 때 환경 설정을 위해 자동으로 수행되는 설정 파일

**login shell vs. non-login shell**

- 로그인 셸
    - 사용자 계정 및 암호를 입력해 로그인에 성공하면, 셸이 자동으로 수행되는데 이때 수행되는 셸
- non-login 셸
    - 로그인 없이 실행되는 셸
    - `bash` 명령어 등으로 실행하는 경우 해당

**bash**

1. **/etc/profile**
    - 모든 사용자에게 적용되는 시스템 수준의 설정 파일
    - 로그인할 때 가장 먼저 수행. 전역 환경변수가 설정됨
2. **~/.bash_profile 혹은 ~/.profile**
    - 우선순위에 따라 2개 중 하나가 실행됨
    - 로그인할 때 수행되며 개별 사용자에게 적용되는 환경설정파일
    - 내부에서 보통 bashrc를 실행
    - 로그아웃할 때까지 유효
    - `ls -a` : 도트(.)로 시작하는 숨김 파일도 볼 수 있는 명령어
3. **~/.bashrc**
    - 로그인 후 셸을 시작할 때마다 수행되며 개별 사용자에게 설정되는 파일
    - 보통 내부에서 /etc/bashrc를 수행함
4. **/etc/bashrc**
    - 로그인 후 셸을 시작할 때마다 모든 사용자에게 적용
    - alias, umask 등 일반적인 설정을 수행함

**zsh**

1. **/etc/zshenv**
    1. 로그인 여부와 무관하게, 모든 사용자에게 시스템 수준에서 적용됨
2. **~/.zshenv**
    1. 마찬가지로 로그인 혹은 비로그인 셸에서 모두 실행되며, 모든 사용자에게 적용
3. **~/.zprofile**
    - 로그인할 때 수행되며 개별 사용자에게 적용됨
4. **~/.zshrc**
    - 로그인 후 셸을 시작할 때마다 수행되며 개별 사용자에게 설정되는 파일

참고 링크: [zsh: 5 Files](https://zsh.sourceforge.io/Doc/Release/Files.html)

- `clear`: 터미널 출력 명령 지우기 (cmd+K)

- 미션 도전!
    1. 위에 언급된 파일 중 자신의 컴퓨터에는 어떤 파일이 존재하나요? 그리고 각각 파일 안에는 어떤 내용이 담겨 있나요?
    2. 혹시 중복되거나 필요 없는 내용이 있나요? 한번 정리해 보세요! (중요: 백업을 권장합니다! 날리면 못찾아요!)

---

## 사용자와 그룹

- Q. /etc 디렉터리 내부 파일을 수정할 수 있나요? `vi` 명령어로 수정을 시도해보세요.
- 수정할 수 없다면 왜그럴까요? `ls -l` 을 실행해봅시다.

```bash
$ ls -l

drwx------@   3 jeesoohong  staff         96  6 10  2019 Applications
drwx------@   4 jeesoohong  staff        128 11 25 11:17 Desktop
drwx------@ 473 jeesoohong  staff      15136 12 27 21:28 Documents
-rw-r--r--    1 jeesoohong  staff       2106 11 13 10:34 test.js
```

1. `d` 혹은 `-`
    1. 파일 종류를 나타냄
    2. `-` 는 정규파일을, `d` 는 디렉터리를 나타낸다
2. `rwx------`
    1. 파일의 접근 권한을 표시
    2. 첫번째 `rwx` 는 소유자, 두 번째 `---` 는 그룹의 구성원, 세 번째 `---` 는 기타 모두의 접근 권한
    3. `rwx`: read/write/execute
    4. `-` : no permission
3. `3`
    1. 같은 파일을 다른 이름으로 다룰 수 있는 하드링크의 수
4. `jeesoohong`
    1. 파일 소유자 계정
5. `staff`
    1. 파일 소유 그룹 계정
6. `96`
    1. 바이트 단위 파일 크기
7. `6 10 2019`
    1. 수정한 월/일/년도 혹은 시간
8. `Applications`
    1. 파일 혹은 디렉터리 이름

---

## 접근권한

- 파일 혹은 디렉터리에 다른 사용자 혹은 특정 그룹들이 어떤 수준으로 접근 가능할지 정할 수 있음
- 소유자(u), 그룹(g), 기타(o) 세 부류 각각에 관해 ‘읽기(r), 쓰기(w), 실행(x)’ 권한을 설정할 수 있음

- 퀴즈
    - `rw-r-----`
    - `-wx--xr--`
    - `rwxrw-r--`

- **읽기**
    - 파일) 파일 내용을 볼 수 있는 권한
    - 디렉터리) 디렉터리에 어떤 파일과 서브 디렉터리가 있는지 목록을 볼 수 있음 (읽기 권한이 없으면 디렉터리 참조가 불가)
- **쓰기**
    - 파일) 파일 내용, 이름 수정 혹은 삭제 가능 권한
    - 디렉터리) 디렉터리에 파일이나 서브 디렉터리를 만들거나 삭제 가능
- **실행**
    - 파일) 말그대로 실행
    - 디렉터리) 디렉터리로 이동(`cd`)하고 디렉터리 내에서 프로그램 실행 가능하며 파일의 메타정보에 접근 가능

**주의!** 실제 사용자가 디렉터리를 자유롭게 사용하려면 읽기/쓰기/실행 권한은 모두 있어야 하고, 적어도 읽기/실행은 있어야 해당 디렉터리로 이동하거나 `ls -l` 명령어 실행이 가능!

- 일반적인 디렉터리 권한: `rwxr-xr-x`
    - `mkdir` 로 폴더를 만들어 한번 확인해보세요!
    - 디렉터리 권한을 설명해보세요!
        
        소유자가 아니라면 디렉터리 이동 및 참조는 가능하지만 쓰기는 불가능함.
        
- 일반적인 파일 권한: `rw-r--r--`
    - `touch` 로 파일을 만들어보세요!
    - 파일 권한을 설명해보세요!
        
        소유자는 읽고 쓸 수 있으나 실행은 안되고, 소유자가 아닐 경우 읽는 것만 가능
        

**접근 권한 변경 `chmod`** 

- `type chmod` : 명령어 종류 확인
- `which chmod` : 실행 프로그램 확인
- `man chmod` : 명령어에 대한 설명

---

- -(제거)
    - `chmod u-w test.js` 사용자에게 쓰기 권한 없애기
- +(추가)
    - `chmod g+x test.js` 그룹에게 실행 권한 추가
- =(지정)
    - `chmod go=rwx test.js` 그룹 및 기타 사용자에게 읽기/쓰기/실행 권한 지정
- `,` 사용해서 여러 개도 가능
- u/g/o가 없으면 전체한테 다 됨
- 세 자리 8진수 사용
    - 소유자/그룹/기타 사용자 각각의 권한을 2진수로 표현하고, 그 권한의 합을 8진수로 표현해 8진수 3자리로 권한 표현 가능 (최대 777, 최소 000)
        - r: 2^2으로 표현 가능하며, 권한이 있으면 4 없으면 0
        - w:2^1으로 표현 가능하며, 권한이 있으면 2 없으면 0
        - x: 2^0으로 표현 가능하며, 권한이 있으면 1 없으면 0
        - 그래서 세 값을 더한 값이 소유자(혹은 그룹 혹은 기타)의 권한값이 됨
    - `chmod 644 test.js` 8진수 지정

| 000 | --------- |
| --- | --- |
| 777 | rwxrwxrwx |
| 001 | --------x |
| 002 | -------w- |
| 003 | -------wx |
| 004 | ------r-- |
| 005 | ------r-x |
| 006 | ------rw- |
| 007 | ------rwx |
| 644 | ? |
| 755 | ? |

**파일 소유자 변경: `chown`**

- 파일/디렉터리에 대한 사용자 변경
- 일반 사용자는 불가능하며, root 사용자는 가능함
- `chown 사용자 디렉터리 -R` : 서브 디렉터리 이하도 한꺼번에 변경 (recursive)
    - `users` 시스템 내 사용자 확인
- `chgrp` : change group의 약자로, 파일/디렉터리에 대한 그룹 변경 가능

- 퀴즈 (방통대 시험 맛보기!)
    1. 현재 디렉터리에 있는 test 파일의 접근 권한을 소유자는 읽기와 쓰기 권한, 그룹은 읽기 권한, 다른 사용자는 아무 권한이 없도록 설정하는 명령어는?
        1. `chmod u+rw,g+r,o-rwx test` 
        2. `chmod 640 test`
        3. `chmod ug+r,u+w,o= test`
        4. `chmod 755 test`
    2. 다음 내용에 대한 설명이 **옳지 않은** 것은?
        1. 이 파일은 linux라는 사용자가 실행 권한을 가지고 있다.
        2. 일반 사용자는 이 파일에 접근할 수 없다.
        3. root 사용자는 이 파일을 수정할 수 있다.
        4. 파일의 소유자는 삭제할 수 있는 권한도 있다.
    
    ```bash
    $ ls -l ihd_test.txt
    	-rwxr----- 1 ihd linux 1024 Sep 11 09:22 ihd.test.txt
    ```
    

---

- 다음에 기회가 된다면…
    1. `ssh` : 안전하게 원격 접속하기
    2. 텍스트 파일 편집하기: `vi` 기본 사용법
    3. 프로세스 관리 (`ps`, `kill`, `jobs`…)
    4. 명령어 실행/조합/파일전환 등 사용법 (`grep`, `|`...)
    5. 셸 스크립트
    6. jenkins/package.json/ssh-term 등 두려움 없이 명령어 이해하고 사용해 보기